{
  "kind": "build_request",
  "title": "Add admin file upload for study materials (host files in-canister and attach to resources)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-14",
      "text": "Extend the backend resource model to support file-backed materials in addition to external URLs, and expose admin-only APIs to upload and manage files.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-12"
        ],
        "quotes": [
          "yes it is ok give the admin upload materials",
          "give"
        ]
      },
      "acceptanceCriteria": [
        "Existing resources that only have (title, url) continue to work without modification for public browsing/searching.",
        "Backend exposes admin-only upload flow to create a stored file (binary content) and returns a stable identifier that can be attached to a resource entry.",
        "Backend exposes a query method that returns a public download URL (or enough info to construct one) for a stored file-backed resource so students can open/download it without authentication.",
        "All upload/manage methods trap with a clear Unauthorized error when caller is not an admin.",
        "Resource CRUD supports creating/editing a resource as either (a) external link or (b) uploaded file-backed link, without breaking existing department/semester/subject data."
      ]
    },
    {
      "id": "REQ-15",
      "text": "Add an admin UI workflow in the Admin > Resources tab to upload a file (e.g., PDF) and attach it to a selected Department/Semester/Subject as a new resource, alongside the existing external-URL flow.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-12"
        ],
        "quotes": [
          "yes it is ok give the admin upload materials",
          "give"
        ]
      },
      "acceptanceCriteria": [
        "Admin can choose between adding a resource via external URL or via file upload.",
        "File upload UI includes: file picker, title input, department/semester/subject selection, and a submit button that is disabled while uploading.",
        "After a successful upload + resource creation, the departments query cache is invalidated/refetched and the new resource appears in the admin list without a manual refresh.",
        "Validation prevents submission when required fields are missing, and shows user-facing errors in English (no crashes).",
        "No changes are made to immutable hook/component paths listed in SYSTEM_CONTEXT."
      ]
    },
    {
      "id": "REQ-16",
      "text": "Update public resource rendering so that resources backed by uploaded files open/download correctly, while external URL resources keep opening their external link.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-12"
        ],
        "quotes": [
          "yes it is ok give the admin upload materials",
          "give"
        ]
      },
      "acceptanceCriteria": [
        "On Browse/Subject/Search pages, clicking “Open” for an external resource still opens the existing resource.url in a new tab.",
        "For file-backed resources, clicking “Open” opens the generated public download URL in a new tab and successfully downloads/opens the file.",
        "Resource type badges and existing list styling continue to render without runtime errors."
      ]
    },
    {
      "id": "REQ-17",
      "text": "Update the Admin Help section text to include instructions for uploading files directly in PREMJI (in addition to the existing external-hosting instructions), keeping all user-facing text in English.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4",
          "msg-12"
        ],
        "quotes": [
          "yes it is ok give the admin upload materials",
          "give"
        ]
      },
      "acceptanceCriteria": [
        "Admin Help section explains both options: (1) upload a file in PREMJI and (2) link to an externally hosted file.",
        "Help content does not claim PREMJI cannot host files directly (update existing wording to match the new capability)."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor (all logic in backend/main.mo).",
    "Create/modify backend/migration.mo only if needed to preserve existing stable state when changing the Resource type.",
    "Do not edit any files under frontend/src/components/ui or any paths listed in frontend.immutablePaths in SYSTEM_CONTEXT.",
    "Use English for all user-facing UI text."
  ],
  "nonGoals": [
    "Integrating third-party file hosting providers (Google Drive/Dropbox APIs) or any external storage service.",
    "Real-time upload progress via WebSockets or push notifications.",
    "Large-file streaming optimizations beyond a basic chunked upload if required by platform limits."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}